
***order total 
```
select o.order_id , sum(b.sum_p1) from orders o
join (select d.order_id , sum(a.sum_p) as sum_p1
  from order_details d
  join ( select prod_id, sum(price) as sum_p
         from products
         group by prod_id
        order by sum_p 
        limit 10
        )a  on d.prod_id = a.prod_id
 group by order_id
 order by sum_p1
 limit 3)b on b.order_id = o.order_id;
```

```
1	5321030
2	6019748
3	6648780
```

*** revenue and profit
```
 SELECT to_date(order_date) as odate
          , sum(price) AS revenue
          , sum(price-cost) as profit 
     FROM products p 
       join order_details d  on p.prod_id = d.prod_id 
       join orders o           on d.order_id = o.order_id
     group by to_date(order_date) ;
```

*** ranking daily profits by month
```
select odate
       , profit
       , row_number() over(partition by year(odate), month(odate) oder by profit desc) as rn1
 from(
 SELECT to_date(order_date) as odate
          , sum(price) AS revenue
          , sum(price-cost) as profit 
     FROM products p 
       join order_details d  on p.prod_id = d.prod_id 
       join orders o           on d.order_id = o.order_id
     group by to_date(order_date) 
 ) a 
order by odate; 
```
```
1  2008-06-01	183853	30
2	2008-06-02	259305	13
3	2008-06-03	222043	23
4	2008-06-04	199194	27
5	2008-06-05	234216	18
6	2008-06-06	227747	20
7	2008-06-07	332916	6
8	2008-06-08	274923	10
9	2008-06-09	228498	19
10	2008-06-10	395146	1
11	2008-06-11	289590	9
12	2008-06-12	348727	4
13	2008-06-13	295702	8
14	2008-06-14	194992	29
15	2008-06-15	198708	28
16	2008-06-16	241668	16
17	2008-06-17	223114	22
18	2008-06-18	244495	15
19	2008-06-19	262945	12
20	2008-06-20	357019	3
21	2008-06-21	252941	14
22	2008-06-22	217220	25
23	2008-06-23	204337	26
24	2008-06-24	234935	17
25	2008-06-25	271516	11
26	2008-06-26	312164	7
27	2008-06-27	369525	2
28	2008-06-28	221500	24
29	2008-06-29	226238	21
30	2008-06-30	342063	5
31	2008-07-01	226267	23
32	2008-07-02	177578	31
33	2008-07-03	254310	14
34	2008-07-04	253398	15
35	2008-07-05	238636	19
36	2008-07-06	260795	12
37	2008-07-07	260698	13
38	2008-07-08	233930	21
39	2008-07-09	312517	6
40	2008-07-10	398091	1
41	2008-07-11	197895	29
42	2008-07-12	214525	27
43	2008-07-13	354096	3
44	2008-07-14	269277	10
45	2008-07-15	225573	24
46	2008-07-16	220844	25
47	2008-07-17	282920	9
48	2008-07-18	207351	28
49	2008-07-19	304468	7
50	2008-07-20	215715	26
51	2008-07-21	331738	5
52	2008-07-22	269130	11
53	2008-07-23	391462	2
54	2008-07-24	234398	20
55	2008-07-25	291098	8
56	2008-07-26	244390	16
57	2008-07-27	229824	22
58	2008-07-28	194383	30
59	2008-07-29	340573	4
60	2008-07-30	242139	18
61	2008-07-31	243883	17
62	2008-08-01	238202	16
63	2008-08-02	337701	2
64	2008-08-03	236718	19
65	2008-08-04	254526	14
66	2008-08-05	236328	20
67	2008-08-06	210342	25
68	2008-08-07	348090	1
69	2008-08-08	304674	6
70	2008-08-09	335926	3
71	2008-08-10	207925	27
72	2008-08-11	243792	15
73	2008-08-12	220629	22
74	2008-08-13	279187	12
75	2008-08-14	216867	23
76	2008-08-15	302756	7
77	2008-08-16	208754	26
78	2008-08-17	237610	17
79	2008-08-18	294420	8
80	2008-08-19	193064	28
81	2008-08-20	182437	31
82	2008-08-21	190051	29
83	2008-08-22	223129	21
84	2008-08-23	292121	9
85	2008-08-24	308630	5
86	2008-08-25	183484	30
87	2008-08-26	312765	4
88	2008-08-27	284808	10
89	2008-08-28	265176	13
90	2008-08-29	214279	24
91	2008-08-30	237492	18
92	2008-08-31	284449	11
93	2008-09-01	201515	25
94	2008-09-02	249934	14
95	2008-09-03	280669	7
96	2008-09-04	245085	16
97	2008-09-05	227610	19
98	2008-09-06	230051	17
99	2008-09-07	262341	13
100	2008-09-08	200050	26
 ```
